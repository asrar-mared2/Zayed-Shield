name: ğŸ“ ØªÙˆÙ„ÙŠØ¯ CHANGELOG ØªÙ„Ù‚Ø§Ø¦ÙŠ

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  changelog:
    name: ØªÙˆÙ„ÙŠØ¯ CHANGELOG.md
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ§  Ø¥Ø¹Ø¯Ø§Ø¯ Git
        run: |
          git config user.name "asrar-mared"
          git config user.email "asrar-mared2@users.noreply.github.com"

      - name: ğŸ“ ØªÙˆÙ„ÙŠØ¯ CHANGELOG.md
        run: |
          latest_tag=$(git describe --tags --abbrev=0 HEAD^ || echo "")
          current_tag=${GITHUB_REF#refs/tags/}
          echo "## $current_tag" > CHANGELOG.md
          if [ -n "$latest_tag" ]; then
            git log "$latest_tag"..HEAD --pretty=format:"- %s" >> CHANGELOG.md
          else
            git log --pretty=format:"- %s" >> CHANGELOG.md
          fi

      - name: ğŸš€ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          git add CHANGELOG.md
          git commit -m "ğŸ“ ØªØ­Ø¯ÙŠØ« CHANGELOG Ù„Ù„Ø¥ØµØ¯Ø§Ø± $current_tag"
          git push
