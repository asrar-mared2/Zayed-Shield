name: "ğŸ” ØªÙˆÙ‚ÙŠØ¹ Ø¥ØµØ¯Ø§Ø± GPG"
description: "ÙŠÙˆÙ‚Ù‘Ø¹ tags ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ GPG Ø±Ø³Ù…ÙŠ"
inputs:
  tag:
    description: "Ø§Ø³Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± (tag) Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙˆÙ‚ÙŠØ¹Ù‡"
    required: true
  gpg-private-key:
    description: "Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ (Ù…Ø´ÙÙ‘Ø± Ø¨ØµÙŠØºØ© base64)"
    required: true
  passphrase:
    description: "ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙØªØ§Ø­"
    required: true

runs:
  using: "composite"
  steps:
    - name: ğŸ§© Ø¥Ø¹Ø¯Ø§Ø¯ GPG
      shell: bash
      run: |
        mkdir -p ~/.gnupg
        echo "$GPG_PRIVATE_KEY" | base64 -d | gpg --batch --import
        echo "allow-loopback-pinentry" >> ~/.gnupg/gpg-agent.conf
        echo "pinentry-mode loopback" >> ~/.gnupg/gpg.conf
        echo RELOADAGENT | gpg-connect-agent
      env:
        GPG_PRIVATE_KEY: ${{ inputs.gpg-private-key }}

    - name: âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Git
      shell: bash
      run: |
        git config --global user.name "asrar-mared"
        git config --global user.email "nike4942@proton.me"
        git config --global user.signingkey 75F4C262CE488AAC7FBD5725BA0198002B6BAB42
        git config --global commit.gpgsign true
        git config --global tag.gpgsign true

    - name: ğŸ·ï¸ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥ØµØ¯Ø§Ø±
      shell: bash
      run: |
        git tag -d "$TAG" || true
        git tag -s "$TAG" -m "ğŸ” Ø¥ØµØ¯Ø§Ø± Ø±Ø³Ù…ÙŠ Ù…ÙˆÙ‚Ù‘Ø¹: $TAG" "$TAG"
        git push --force origin "$TAG"
      env:
        TAG: ${{ inputs.tag }}
        GPG_TTY: ${{ runner.tty }}
        GPG_PASS: ${{ inputs.passphrase }}
